# Описание проекта
Проект осуществляет инференс обученной алгоритмом Random Forest модели для определения сетевых атак.
# Структура проекта
* **src/** - здесь хранятся все коды для запуска инференса модели на C/C++
  * `main.cpp` - основной код программы
  * `random_forest_model.c` - код обученной модели, преобразованный из python кода
  * `random_forest_model.h` - заголовок
* **python/** - здесь хранятся коды обработки датасетов, а также коды поиска модели и обучения модели
  * `reducing_dataset.py` - код, который сокращает исходный датасет до такого размера, чтобы осталось по 30000 строк на каждый класс
  * `processing_dataset.py` - код, который обрабатывает данные сокращённого датасета
  * `finding_model.py` - код подбора по метрикам оптимального алгоритма для обучения модели
  * `randomforest.py` - код обучения модели алгоритмом Random Forest и сохранение в C файл
  * `preparing_test_data.py` - код обработки тестовых данных
* **data/** - здесь находятся все датасеты, полученные в ходе исполнения кодов
  * **source_data/**
    * `df_balanced.csv` - датасет полученный после сокращения исходных данных до 30000 строк на каждый класс
    * `prepared_dataset.csv` - датасет, готовый к использованию для обучения модели
  * **test_data/**
    * `test_data.csv` - датасет тестовых данных, которые будут использоваться для проверки работы приложения
    * `data_with_label.csv` - датасет, полученный в результате выполнения кода preparing_test_data со столбцом целевой переменной
    * `data_without_label.csv` - датасет, полученный в результате выполнения кода preparing_test_data без столбца целевой переменной
* `.gitignore` — указывает Git, какие файлы и папки не нужно отслеживать
* `.gitattributes` — определяет, как Git должен обрабатывать файлы
# Описание работы
1. **Поиск датасета**
- В качестве исходных данных был выбран датасет CICIDS2017 с сайта `https://www.unb.ca/cic/datasets/ids-2017.html`. В результате был создан файл по ссылке: `https://drive.google.com/file/d/1ptdKAv9nz3SjerX1soALm4T94QLCB8fr/view?usp=sharing`
2. **Подготовка датасета**
- Подготовка датасета проходила в два этапа. Первый этап включал в себя сокращение исходного датасета до 120000 строк и был создан файл `df_balanced.csv`(весь датасет занимал 1.1 гб, поэтому было принято решение сократить его, оставив на каждый класс по 30000 строк. Это число достаточно оптимально для построения хорошей модели.), а на втором этапе проходила подготовка датасета к использованию в обучении модели. Для этого из датасета были удалены информационные столбцы: ('Flow ID', 'Source IP', 'Source Port', 'Destination IP', 'Destination Port', 'Timestamp', 'Protocol'), столбец с атаками был закодирован методом Label encoding. Была проведена проверка на наличие сильной зависимости целевой переменной от какого-то отдельного признака (это могло свидетельствовать об утечке данных). Также был проведён корреляционный анализ: были найдены коэффициенты корреляциями между парами признаков и исключены из датасета по одному признаку из сильнокоррелирующих пар (коэффициент корреляции >0.95). В результате был создан файл `prepared_dataset.csv`.
3. **Поиск модели**
- В качестве потенциальных алгоритмов были выбраны следующие:
  - CART
  - Random Forest
  - Logistic Regression
  - Naive Bayes
  - LDA
- Для выбора алгоритма датасет был разделён на обучающую и тестовую выборки и все модели были обучены на обучающих данных. Качество ответов от моделей было оценено по следующим метрикам:
  - Accuracy (доля правильных ответов)
  - Precision (точность)
  - Recall (полнота)
  - F1 (F1-мера, гармоническое среднее между точностью и полнотой)
  - Время вычисления предсказания
- По полученным результам в качестве эталонного алгоритма был выбран алгоритм Random Forest в силу наличия самых больших результатов по метрикам (все метрики превышали 0,99).
4. **Обучение модели и генерация C кода**
- Модель обучилась по уже известному алгоритму Random Forest, а также был сгенерирован C код с описанием алгоритма на языке C и заголовочный файл.
5. **Создание инференса на C**
- Для интеграции модели в C++ была использована библиотека m2cgen, которая преобразовала обученную модель Random Forest в чистый C-код (random_forest_model.c). Это позволило запускать инференс без зависимости от Python. C++ приложение (main.cpp) читает подготовленные CSV-файлы, передаёт признаки в сгенерированную модель и выводит результаты классификации. Такой подход обеспечивает высокую производительность и кроссплатформенность. 
6. **Тестирование**
- Были выбраны данные из исходного датасета, не участвующие ни в обучении, ни в тестировании модели, и обработаны так, чтобы модель могла по полученным входящим данным выдать предсказание о классификации сетевой атаки. Эти данные были прогнаны через preparing_test_data.py, чтобы программа могла корректно предсказать атаку. Программа работает так, что пользователю предлагается указать путь до данных без предсказанной атаки и с ней. Если пользователь не указывает путь до файла с предсказанной атакой, то в результате просто получает предсказанные атаки. Если же пользователь хочет проверить корректность предсказаний, он может указать путь до файла с истинными атаками и увидеть, где модель правильно предсказала атаку, а где ошиблась.
# Запуск приложения
1. Склонируйте репозиторий к себе на локальный компьютер: `git clone https://github.com/Dashkere404/Attack-detection-app.git`
2. Перейдите в папку с проектом: `cd Attack-detection-app`
3. Убедитесь, что у вас установлен MinGW (g++) (желательно версия 8.1.0)
4. Скомпилируйте файл с кодом модели в объектный файл: `gcc -c random_forest_model.c -o random_forest_model.o`
5. Соберите С и С++ файлы в один исполняемый файл: `g++ main.cpp random_forest_model.o -o detector`
6. Запустите приложение: `./detector`
7. Вам будет предложено вставить путь до csv файла, в котором хранятся ваши данные, атаку для которых вы хотите узнать.
  - **Важно!** Рекомендуется ваш исходный csv файл прогнать через preparing_test_data.py, чтобы получить корректные датасеты, по которым модель может предсказать атаку.
8. Вам также опционально будет предложено вставить путь до csv файла, в котором уже есть данные с известными атаками. Так вы сможете проверить, правильно ли модель предсказывает атаки.
  - **Проверка работы программы** Для проверки работы программы в первую строку вставьте путь до файла `data_without_label.csv`, а во вторую - путь до `data_with_label.csv`
